import{_ as B,g,h as p,E as u,i as y,c as I,a as n,n as k,d as r,w as s,j as U,r as v,o as q,e as c}from"./index-B3xJ9HZf.js";const R={class:"container"},j={__name:"Login",setup(E){const m=g(!1),d=g(""),i=g(""),V=g(""),b={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应在 3 到 20 个字符之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度应大于等于6个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}]},x=()=>{m.value=!0},w=()=>{m.value=!1},C=async()=>{try{const l=await p.post("/api/users/login",null,{params:{name:d.value,password:i.value}}),{status:e,message:t,token:o}=l.data;e==="success"?(u.success(t),localStorage.setItem("userToken",o),p.defaults.headers.Authorization=`Bearer ${o}`,y.push("/"),window.location.reload()):u.error(t)}catch(l){u.error("登录请求失败，请稍后再试"),console.error(l)}},z=async()=>{try{(await p.post("/api/users/save",{name:d.value,email:V.value,password:i.value})).data?(u.success("注册成功"),w()):u.error("注册失败，请检查输入")}catch(l){u.error("注册请求失败，请稍后再试"),console.error(l)}};return p.interceptors.request.use(l=>{const e=localStorage.getItem("userToken");return e&&(l.headers.Authorization=`Bearer ${e}`),l},l=>Promise.reject(l)),p.interceptors.response.use(l=>l,l=>(l.response&&l.response.status===401&&(u.error("未登录或登录信息已过期，请重新登录"),y.push("/login")),Promise.reject(l))),(l,e)=>{const t=v("el-input"),o=v("el-form-item"),f=v("el-button"),_=v("el-form");return q(),I("div",R,[n("div",{class:U(["flip-container",{flipped:m.value}])},[n("div",{class:"front",style:k({zIndex:m.value?1:2})},[r(_,{model:l.form,rules:b,ref:"formRef"},{default:s(()=>[e[7]||(e[7]=n("h1",null,"登录",-1)),e[8]||(e[8]=n("br",null,null,-1)),r(o,{label:"用户名",prop:"username"},{default:s(()=>[r(t,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),r(o,{label:"密码",prop:"password"},{default:s(()=>[r(t,{type:"password",modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),r(o,null,{default:s(()=>[r(f,{type:"primary",onClick:C},{default:s(()=>e[5]||(e[5]=[c("登录")])),_:1})]),_:1}),r(o,null,{default:s(()=>[r(f,{onClick:x},{default:s(()=>e[6]||(e[6]=[c("去注册")])),_:1})]),_:1})]),_:1},8,["model"])],4),n("div",{class:"back",style:k({zIndex:m.value?2:1})},[r(_,{model:l.form,rules:b,ref:"formRef"},{default:s(()=>[e[11]||(e[11]=n("h1",null,"注册",-1)),e[12]||(e[12]=n("br",null,null,-1)),r(o,{label:"用户名",prop:"username"},{default:s(()=>[r(t,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=a=>d.value=a),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),r(o,{label:"邮箱",prop:"email"},{default:s(()=>[r(t,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=a=>V.value=a),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),r(o,{label:"密码",prop:"password"},{default:s(()=>[r(t,{type:"password",modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value=a),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),r(o,null,{default:s(()=>[r(f,{type:"primary",onClick:z},{default:s(()=>e[9]||(e[9]=[c("注册")])),_:1})]),_:1}),r(o,null,{default:s(()=>[r(f,{onClick:w},{default:s(()=>e[10]||(e[10]=[c("返回登录")])),_:1})]),_:1})]),_:1},8,["model"])],4)],2)])}}},N=B(j,[["__scopeId","data-v-a8f5bf04"]]);export{N as default};
