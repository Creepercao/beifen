import{_ as K,r as k,o as L,c as p,g as a,t as n,h as m,i as v,F as I,b as S,p as D,e as c,E as w,k as $,f as i,j as _,n as x,d as R,D as H}from"./index-CpKDPpXK.js";const j={class:"article-container"},q={class:"article-title"},G={class:"author-info"},J={class:"author-left"},O={class:"author-name"},P={class:"author-right"},Q={class:"publish-time"},W=["innerHTML"],X={class:"tags-container"},Y={class:"comments-section"},Z={class:"comment-content"},ee={class:"comment-time"},te={class:"maincontent"},se={key:0,class:"replies"},ae={class:"reply-content"},oe={class:"comment-time"},ne={class:"maincontent"},le={__name:"Show",setup(re){const s=k({title:"",uuid:"",name:"",avatar:"",createdAt:"",tags:[],likes:0,content:"",comments:[]}),y=k(!1),g=k(""),V=k(null),h=k(""),f=D().params.id,z=async()=>{try{const t=await c.get(`/api/articles/${f}`);s.value=t.data;const e=await c.get(`/api/users/${s.value.uuid}`);s.value.avatar=e.data.avatar,s.value.name=e.data.name;const u=await c.get(`/api/comments/article/${f}`);s.value.comments=u.data;for(let l of s.value.comments){const b=await c.get(`/api/users/${l.userUuid}`);l.user=b.data;const C=await c.get(`/api/replies/comment/${l.id}`);l.replies=C.data;for(let o of l.replies){const d=await c.get(`/api/users/${o.user}`);o.userdata=d.data}}}catch(t){console.error("获取文章和评论失败",t)}},A=async()=>{try{const t=await c.post(`/api/articles/${f}/like`);s.value.likes=t.data.likes}catch(t){console.error("点赞失败",t)}},B=async()=>{const t=localStorage.getItem("userToken"),e=localStorage.getItem("uuid");if(!t||!e){window.location.href="/#/login";return}try{y.value=!y.value;const u=await c.post(`/api/favorites/user/${e}/article/${f}`,{isFavorited:y.value});y.value?w.success("收藏成功"):w.success("取消收藏成功")}catch(u){console.error("收藏失败",u),w.error("收藏操作失败")}},M=async()=>{if(g.value.trim()!=="")try{const t=await c.post("/api/comments",{articleId:f,userUuid:localStorage.getItem("uuid"),content:g.value});s.value.comments.push(t.data),g.value="",window.location.reload()}catch(t){console.error("发布评论失败",t)}},N=async t=>{try{const e=await c.delete(`/api/comments/${t}`);w.success(e.data),s.value.comments=s.value.comments.filter(u=>u.id!==t)}catch(e){console.error("删除评论失败",e),w.error("删除评论失败")}},T=t=>{V.value=t},E=async t=>{if(h.value.trim()!=="")try{const e=await c.post("/api/replies",{user:parseInt(localStorage.getItem("uuid"),10),comment:s.value.comments[t].id,content:h.value});s.value.comments[t].replies.push(e.data),h.value="",window.location.reload(),V.value=null}catch(e){console.error("回复失败",e)}};return L(z),(t,e)=>{const u=$("el-avatar"),l=$("el-button"),b=$("el-tag"),C=$("el-input");return i(),p("div",j,[a("h1",q,n(s.value.title),1),a("div",G,[a("div",J,[m(u,{src:s.value.avatar,size:"medium"},null,8,["src"]),a("span",O,n(s.value.name),1)]),a("div",P,[a("span",Q,n(s.value.createdAt),1),m(l,{type:"text",onClick:A},{default:v(()=>[_(" 👍 点赞 "+n(s.value.likes),1)]),_:1}),m(l,{type:"text",onClick:B},{default:v(()=>[_(n(y.value?"⭐ 已收藏":"⭐ 收藏"),1)]),_:1})])]),a("div",{class:"article-content",innerHTML:s.value.content},null,8,W),a("div",X,[(i(!0),p(I,null,S(s.value.tags,(o,d)=>(i(),x(b,{key:d,type:"success"},{default:v(()=>[_(n(o),1)]),_:2},1024))),128))]),a("div",Y,[e[5]||(e[5]=a("h2",{class:"comments-title"},"评论",-1)),m(C,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o),placeholder:"写下你的评论...",type:"textarea",rows:3},null,8,["modelValue"]),m(l,{type:"primary",class:"submit-comment",onClick:M},{default:v(()=>e[2]||(e[2]=[_(" 发布评论 ")])),_:1}),(i(!0),p(I,null,S(s.value.comments,(o,d)=>{var F;return i(),p("div",{key:o.id,class:"comment-item"},[o.user?(i(),x(u,{key:0,src:o.user.avatar,size:"default",style:{"margin-top":"5px"}},null,8,["src"])):R("",!0),a("div",Z,[a("p",null,[a("strong",null,n(((F=o.user)==null?void 0:F.name)||"匿名"),1),a("span",ee,n(o.time),1)]),a("p",te,n(o.content),1),m(l,{type:"text",class:"delete-button",onClick:r=>N(o.id)},{default:v(()=>e[3]||(e[3]=[_(" 删除 ")])),_:2},1032,["onClick"]),o.replies&&o.replies.length>0?(i(),p("div",se,[(i(!0),p(I,null,S(o.replies,(r,ie)=>{var U;return i(),p("div",{key:r.id,class:"reply-item"},[r.userdata?(i(),x(u,{key:0,src:r.userdata.avatar,size:"small",style:{"margin-top":"5px"}},null,8,["src"])):R("",!0),a("div",ae,[a("p",null,[a("strong",null,n(((U=r.userdata)==null?void 0:U.name)||"匿名"),1),a("span",oe,n(r.time),1)]),a("p",ne,n(r.content),1)])])}),128))])):R("",!0),m(l,{type:"text",class:"reply-button",onClick:r=>T(d)},{default:v(()=>e[4]||(e[4]=[_(" 回复 ")])),_:2},1032,["onClick"]),V.value===d?(i(),x(C,{key:1,modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=r=>h.value=r),placeholder:"回复评论...",size:"small",onKeyup:H(r=>E(d),["enter","native"])},null,8,["modelValue","onKeyup"])):R("",!0)])])}),128))])])}}},de=K(le,[["__scopeId","data-v-513176c7"]]);export{de as default};
